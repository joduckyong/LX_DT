{{>layout/header}}

        <div class="right_col" role="main">
          <div class="row">
            <div class="col-md-12">
              <div class="x_panel"> 
                <div class="x_title"> 
                  <h2>HOME > 모니터링</h2>
                  <div class="clearfix"> </div>
                </div>
                <div class="x_content"> <br>
                  <div class="progress_tab">
                    <div class="tab_item" id="tab-0">
                      <div class="row">
                        <div class="col-12 col-md-6 mx-0">
                          <h4 class="center_title">수집현황</h4>
                          <canvas id="mybarChart"></canvas>
						  <div class="table_responsive scroll_y">
                            <table class="table table-striped table-bordered bulk_action">
                              <colgroup>
                                <col width="55px">
                              </colgroup>
                              <thead>
                                <tr>
                                  <th></th>
                                  <th>Adapter1</th>
                                  <th>Adapter2</th>
                                  <th>Adapter3</th>
                                  <th>Adapter4</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr>
                                  <td>요청건수</td>
                                  <td>시계열_분석_이미지</td>
                                  <td>img_01</td>
                                  <td>시계열 분석용</td>
                                  <td>시계열 분석용</td>
                                </tr>
                                <tr>
                                  <td>적재건수</td>
                                  <td>시계열_분석_이미지</td>
                                  <td>img_01</td>
                                  <td>시계열 분석용</td>
                                  <td>시계열 분석용</td>
                                </tr>
                                <tr>
                                  <td>오류건수</td>
                                  <td>시계열_분석_이미지</td>
                                  <td>img_01</td>
                                  <td>시계열 분석용</td>
                                  <td>시계열 분석용</td>
                                </tr>
                              </tbody>
                            </table>
                          </div>                          
                        </div>
                        <div class="col-12 col-md-6 mx-0">
                          <h4 class="center_title">수집동작현황</h4>
                          <canvas id="defaltbarChart"></canvas>
						  <div class="table_responsive scroll_y">
                            <table class="table table-striped table-bordered bulk_action">
                              <colgroup>
                                <col width="50%">
                                <col width="50%">
                              </colgroup>
                              <thead>
                              </thead>
                              <tbody>
                                <tr>
                                  <td style="text-align: center;">Adapter 동작건수</td>
                                  <td style="text-align: center;"><span id="adapter_start_txt"></span></td>
                                </tr>
                                <tr>
                                  <td style="text-align: center;">Adapter 중지건수</td>
                                  <td style="text-align: center;"><span id="adapter_stop_txt"></span></td>
                                </tr>
                                <tr>
                                  <td style="text-align: center;">Instance 동작</td>
                                  <td style="text-align: center;"><span id="instance_start_txt"></span></td>
                                </tr>
                                <tr>
                                  <td style="text-align: center;">Instance 중지</td>
                                  <td style="text-align: center;"><span id="instance_stop_txt"></span></td>
                                </tr>
                                <tr>
                                  <td style="text-align: center;">Instance 오류 중지</td>
                                  <td style="text-align: center;"><span id="instance_error_txt"></span></td>
                                </tr>
                              </tbody>
                            </table>
                          </div>                              
                        </div>
                      </div>
                      
                      <div class="row">
                        <div class="col-12 col-md-12 mx-0">
                          <div class="table_responsive scroll_y">
                            <table class="table table-striped table-bordered bulk_action">
                              <colgroup>
                                <col width="20%">
                                <col width="10%">
                                <col width="20%">
                                <col width="50%">
                              </colgroup>
                              <thead>
                                <tr>
                                  <th style="text-align: center;">적재시간</th>
                                  <th style="text-align: center;">Adapter명</th>
                                  <th style="text-align: center;">상태</th>
                                  <th style="text-align: center;">로그메세지</th>
                                </tr>
                              </thead>
                              <tbody id="dpCmMoniteringLogs">
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                                            
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- modal -->        
		<div class="modal fade add_modal" id="log_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-lg" style="max-width: 800px;">
            <div class="modal-content">
              <div class="modal-header">
                <h2 class="modal-title" id="myModalLabel"><span id="modelLabel">로그상세</span></h2>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
				<div class="x_content">
                  <div class="border_rows">
                    <div class="row">
                      <div class="form-group row col-12 col-md-12">
                        <div class="control-label" style="text-align: center;">적재시간</div>
                        <div class="form-control_box" style="text-align: center;"><span id="log_dt_txt"></span></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">Adapter명</div>
                        <div class="form-control_box"><span id="adapter_nm_txt"></span></div>
                      </div>
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">인스턴스명</div>
                        <div class="form-control_box"><span id="log_desc_txt"></span></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">수집방식</div>
                        <div class="form-control_box"><span id="clct_mthd_txt"></span></div>
                      </div>
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">수집유형</div>
	  					   <div class="form-control_box"><span id="clct_ty_txt"></span></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">상태</div>
                        <div class="form-control_box"><span id="log_desc_txt"></span></div>
                      </div>
                      <div class="form-group row col-12 col-md-6">
                        <div class="control-label" style="text-align: center;">적재테이블</div>
	 					   <div class="form-control_box"><span id="st_datamodel_txt"></span></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="form-group row col-12 col-md-12">
                        <div class="control-label" style="text-align: center;">수신데이터</div>
                        <div class="form-control_box"><p id="data_before_txt"></p></div>
                      </div>
                    </div>
                    
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>        
        
{{>layout/footer}}        

<script>
const commonUrl = '/common';
const url = '/adaptor';

//데이터로그 상세팝업
const dpCmMoniteringLogsPopup = function(id, log_type){
	
	$('#log_modal').modal('show');
	
    const data = {
	   		url: '/dp/cm/monitering/logs/popup',
	   		id: id,	
	   		log_type: log_type,	
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',	 
	    };		
	    
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpCmMoniteringLogsPopup',
	        dataType: 'json',
	        contentType: 'application/json; charset-utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
		  	  if (data != null) {
			  	   	if(data.contents != ""){    	
				  	   	$("#log_dt_txt").text(data.contents[0].log_dt);
				  	   	$("#adapter_nm_txt").text(data.contents[0].adapter_nm);
				  	   	$("#log_desc_txt").text(data.contents[0].log_desc);
				  	   	$("#clct_mthd_txt").text(data.contents[0].clct_mthd);
				  	   	$("#clct_ty_txt").text(data.contents[0].clct_ty);
				  	   	$("#log_desc_txt").text(data.contents[0].log_desc);
				  	   	$("#st_datamodel_txt").text(data.contents[0].st_datamodel);
				  	   	$("#data_before_txt").text(data.contents[0].data_before);
			  	   	}
		  	  }
	    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });			
}

//데이터로그
const dpCmMoniteringLogs = function(){
	
	$("#dpCmMoniteringLogs").empty();	
    const data = {
	   		url: '/dp/cm/monitering/logs',
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',	 
	    };		
	    
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpCmMoniteringLogs',
	        dataType: 'json',
	        contentType: 'application/json; charset-utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
		  	  if (data != null) {
			  	   	if(data.contents != ""){    	
    		     	    let insertTr = '';
    			  	    $.each(data.contents, function (idx, el) {
  		     	          insertTr += '<tr onclick=dpCmMoniteringLogsPopup("'+el.id+'","'+el.log_type+'")>';
		     		      insertTr += ' <td>'+el.log_dt+'</td>';
		     		      insertTr += ' <td>'+el.adapter_nm+'</td>';
		     		      insertTr += ' <td>'+el.log_desc+'</td>';
		     		      insertTr += ' <td>'+el.payload+'</td>';
		                  insertTr += '</tr>';
		                  i++;
    			  	    });	  			  	    
	  	          	    $("#dpCmMoniteringLogs").append(insertTr);		    			  	    
			  	   	}
		  	  }
	    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });			
}

//수집동작현황
const dpCmMoniteringStatus = function(){
	
    const data = {
	   		url: '/dp/cm/monitering/status',
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',	   	
	    };		
	    
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpCmMoniteringStatus',
	        dataType: 'json',
	        contentType: 'application/json; charset-utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
		  	  if (data != null) {
			  	   	if(data.contents != ""){    	
			  	   		$("#adapter_start_txt").text(data.contents[0].adapter_start);
			  	   		$("#adapter_stop_txt").text(data.contents[0].adapter_stop);
			  	   		$("#instance_start_txt").text(data.contents[0].instance_start);
			  	   		$("#instance_stop_txt").text(data.contents[0].instance_stop);
			  	   		$("#instance_error_txt").text(data.contents[0].instance_error);
			  	   	}
		  	  }
	    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });			
}

//수집현황
const dpCmMoniteringIngest = function(){
	
    const data = {
	   		url: '/dp/cm/monitering/ingest',
	   		daytype: $("#daytype").val(), 	
	   		user_id: 'user00',	
	   		menu_id: 'menu_id',	   		
	    };		
	    
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpCmMoniteringIngest',
	        dataType: 'json',
	        contentType: 'application/json; charset-utf-8',
	        data: JSON.stringify(data)
	    }).done(function (data) {
		  	  if (data != null) {
			  	   	if(data.contents != ""){    	
    			  	    $.each(data.contents, function (idx, el) {
    			  	    	el.log_dt;
    			  	    	el.adapter_nm;
    			  	    	el.log_desc;
    			  	    	el.payload;
    			  	    	el.id;
    			  	    	el.log_type;
    			  	    });
			  	   	}
		  	  }
	    	  
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });			
}
</script>

