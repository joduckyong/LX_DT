{{>layout/header}}

	<div class="right_col" role="main">
	    <div class="row">
	        <div class="col-md-12">
	            <div class="x_panel">
	                <div class="x_title"> 
	                  <h2>HOME > 메타테이블 관리</h2>
	                  <div class="clearfix"> </div>
	                </div>
	                <div class="x_content">
	                	<div class="border_rows">
		                    <div class="row">
		                      <div class="form-group row col-12 col-md-6">
		                        <div class="control-label">테이블 한글명</div>
		                        <div class="form-control_box" id="table_korean_nm">
		                        </div>
		                      </div>
		                      <div class="form-group row col-12 col-md-6">
		                        <div class="control-label">테이블 영문명</div>
		                        <div class="form-control_box" id="table_eng_nm">
		                        </div>
		                      </div>
		                    </div>
						</div>
	            	</div>
	        	</div>
	    	</div>
		</div>
		<div class="row">
		    <div class="col-md-12">
		        <div class="x_panel">
		            <div class="x_title">
		                <h3>컬럼 정보</h3>
		            </div>
		            <div class="x_content">
	                    <div class="table_btns mt-4">
	                    	<button class="btn btn btn-dark" type="button" onclick="jsList();">목록</button>
	                    	<button class="btn btn-primary" type="button" onclick="btnAdd();">추가</button>
	                    	<button class="btn btn-danger" type="button">삭제</button>
                    	</div>
		                <div class="table_responsive" style="height: 500px; overflow: auto">
		                	<div class="talbel_total">총 <span class="red bold" id="total_count"></span>건</div>
		                    <table class="table table-striped" style="text-align: center;">
		                        <colgroup>
		                            <col width="55px">
		                            <col width="15%">
		                            <col width="15%">
		                            <col width="10%">
		                        </colgroup>
		                        <thead>
		                            <tr>
		                                <th>선택</th>
		                                <th>한글명</th>
		                                <th>영문명</th>
		                                <th>데이터타입</th>
		                                <th>데이터길이</th>
		                                <th>Not null 여부</th>
		                                <th>데이터셋종류</th>
		                                <th>PK 정보</th>
		                                <th>FK 정보</th>
		                                <th>개인정보여부</th>
		                                <th>암호화여부</th>
		                                <th>정렬순서</th>
		                            </tr>
		                        </thead>
		                        <tbody id="columnInfo">
		                        </tbody>
		                    </table>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
		<div id="tbl_layer" style="display: none;">
			<div class="row" id="dataset_layer">
			    <div class="col-md-12">
			        <div class="x_panel">
			            <div class="x_title">
			                <h3>컬럼 항목</h3>
			                <div class="clearfix"> </div>
			            </div>
			            <div class="x_content">
			            	<div class="table_btns mt-4">
		                    	<button class="btn btn-primary" type="button" onclick="colSaveBtn();" id="col_save_btn">저장</button>
	                    	</div>
	                    	<div class="table_responsive">
			                    <table class="table table-bordered bulk_action table_center">
			                        <colgroup>
			                        </colgroup>
			                        <thead>
				                        <tr>
				                            <th>한글명(<span class="red bold">*</span>)</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="column_korean_nm" id="column_korean_nm">
				                            </th>
				                            <th>참조 테이블 식별자</th>
				                            <th colspan="3">
				                            	<div class="form-control_box duplicate_box">
					                            	<input class="form-control" type="text"  name="refrn_table_idntfc_id" id="refrn_table_idntfc_id" readonly="readonly">
					                            	<button class="btn btn-primary" onclick="addModal();"> <i class="glyphicon glyphicon-search"></i></button>
				                            	</div>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>영문명(<span class="red bold">*</span>)</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="column_eng_nm" id="column_eng_nm" oninput="handleOnInput(this);">
				                            </th>
				                            <th>참조 테이블명</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="refrn_table_idntfc_id_nm" id="refrn_table_idntfc_id_nm" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>데이터타입(<span class="red bold">*</span>)</th>
				                            <th>
				                                <select class="form-control" name="data_type" id="data_type" onchange="changeDataType(this);">
				                                	<option value="">선택</option>
				                                    <option value="VARCHAR">VARCHAR</option>
				                                    <option value="INTEGER">INTEGER</option>
				                                    <option value="NUMERIC">NUMERIC</option>
				                                    <option value="TIMESTAMPTZ">TIMESTAMPTZ</option>
				                                </select>
				                            </th>
				                            <th>데이터 길이</th>
				                            <th>
				                                <input class="form-control" type="text" name="data_lt" id="data_lt" oninput="handleOnInputNumber(this);" readonly="readonly">
				                            </th>
				                            <th>참조 컬럼 식별자</th>
				                            <th colspan="3">
				                                <select class="form-control" name="refrn_column_idntfc_id" id="refrn_column_idntfc_id" onchange="changeRefrnColumnNm(this);">
				                                	<option value="">선택</option>
				                                </select>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>Not null 여부</th>
				                            <th>
				                                <select class="form-control" name="not_null_at" id="not_null_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>데이터셋 종류</th>
				                            <th>
				                                <select class="form-control" name="dset_knd" id="dset_knd">
				                                    <option value="D">데이터</option>
			                                    	<option value="M">메타정보</option>
				                                </select>
				                            </th>
				                            <th>참조 컬럼명</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="refrn_column_idntfc_id_eng_nm" id="refrn_column_idntfc_id_eng_nm" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>PK 정보</th>
				                            <th>
				                                <select class="form-control" name="pk_info" id="pk_info">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>FK 정보</th>
				                            <th>
				                                <select class="form-control" name="fk_info" id="fk_info">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>수집 테이블 생성 여부</th>
				                            <th colspan="3">
				                                <input class="form-control" type="text" name="creat_table_at" id="creat_table_at" readonly="readonly">
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>사용 여부</th>
				                            <th>
				                                <select class="form-control" name="use_at" id="use_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>컬럼 저장 타입</th>
				                            <th>
				                                <input class="form-control" type="text" name="column_stre_type" id="column_stre_type" readonly="readonly">
				                            </th>
				                            <th rowspan="3">컬럼 설명</th>
				                            <th rowspan="3">
				                                <textarea name="column_dc" id="column_dc" rows="6" style="width: 100%;"></textarea>
				                            </th>
				                            <th rowspan="3">CRUD 설명</th>
				                            <th rowspan="3">
				                                <textarea name="crud_dc" id="crud_dc" rows="6" style="width: 100%;"></textarea>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>정렬 순서</th>
				                            <th>
				                                <input class="form-control" type="text" name="ordr" id="ordr">
				                            </th>
				                            <th>개인정보 여부</th>
				                            <th>
				                                <select class="form-control" name="indvdl_info_at" id="indvdl_info_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                        </tr>
				                        <tr>
				                            <th>암호화 여부</th>
				                            <th>
				                                <select class="form-control" name="encpt_at" id="encpt_at">
				                                    <option value="Y">예</option>
				                                    <option value="N">아니오</option>
				                                </select>
				                            </th>
				                            <th>CRUD 구분</th>
				                            <th>
				                                <select class="form-control" name="crud_se" id="crud_se">
				                                    <option value="C">C</option>
				                                    <option value="U">U</option>
				                                    <option value="D">D</option>
				                                </select>
				                            </th>
				                        </tr>
			                        </thead>
			                    </table>
			                </div>
			            </div>
			        </div>
			    </div>
			</div>
		</div>
	</div>
	<!-- modal -->
        <div class="modal fade add_modal" id="add_modal" tabindex="-1" role="dialog" aria-hidden="true">
          <div class="modal-dialog modal-md">
            <div class="modal-content">
              <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">참조 테이블 검색</h4>
                <button class="close" type="button" data-dismiss="modal"></button><span aria-hidden="true">&times;</span>
              </div>
              <div class="modal-body">
              	<div class="form-horizontal">
	              	<div class="row">
	                  <div class="form-group row col-12 col-md-10">
	                    <input class="form-control" type="text" name="query" id="query" onkeypress="enterkey(event);">
	                  </div>
	                    <button class="btn-sm btn-primary" type="button" onclick="dpIngestPopupMetaTbl();">검색</button>
	                </div>
	                <div class="table_responsive" style="height: 300px; overflow: auto">
                    <table class="table table-striped" style="text-align: center;">
                      <thead>
                        <tr> 
                          <th rowspan="2" style="vertical-align: middle;">데이터셋 한글</th>
                          <th colspan="2">테이블명</th>
                        </tr>
                        <tr>
                          <th>영문</th>
                          <th>국문</th>
                        </tr>
                      </thead>
                      <tbody id="popupMetaTbl">
                      </tbody>
                    </table>
                  </div>
	            </div>
              </div>
            </div>
          </div>
        </div>
        <input type="hidden" name="column_idntfc_id" id="column_idntfc_id"/>
        <input type="hidden" name="btn_type" id="btn_type"/>
        
{{>layout/footer}}        

<script>

const commonUrl = '/common';
const url = '/metaTable';

//메타테이블 항목 상세
const dpIngestMetaTblTbl = function () {
	
	let table_idntfc_id = '{{table_idntfc_id}}'
	
	const data = {
   		url: '/dp/ingest/meta/tables/table',
   		user_id: 'user00',	
   		table_idntfc_id: table_idntfc_id,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestMetaTblTbl',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
	  	  if (data != null) {
  	    	if(data.contents != ""){
	  	    	$("#table_korean_nm").text(data.contents[0].table_korean_nm);
	  	    	$("#table_eng_nm").text(data.contents[0].table_eng_nm);
  	    	}
	  	  }
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//메타테이블 컬럼 항목
const dpIngestMetaTblCol = function () {
	
	let table_idntfc_id = '{{table_idntfc_id}}';
	
	const data = {
   		url: '/dp/ingest/meta/tables/column',
   		user_id: 'user00',
   		table_idntfc_id: table_idntfc_id,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestMetaTblCol',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		  
    		  if(errorMsg(data)){
   	          	 return;  
       	  	  }				
	  		
	  		$("#total_count").text(data.total_count);
  	    	if(data.contents != ""){
  	    		let insertTr = '';
  	    		$.each(data.contents, function (idx, el) {
	  	    		insertTr += '<tr>';
		  	    	insertTr += '	<td><input type="checkbox"></td>';
		  	    	insertTr += '	<td>'+isEmpty(el.column_korean_nm)+'</td>';
		  	    	insertTr += '	<td><span class="blue bold" style="cursor:pointer" onclick=dpIngestMetaTblDetail(\''+el.column_idntfc_id+'\');>'+isEmpty(el.column_eng_nm)+'</span></td>';
		  	    	insertTr += '	<td>'+isEmpty(el.data_type)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.data_lt)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.not_null_at)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.dset_knd)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.pk_info)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.fk_info)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.indvdl_info_at)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.encpt_at)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.ordr)+'</td>';
		  	    	insertTr += '</tr>';
		  	    	
		  	    	
  	    		});
  	    		$("#columnInfo").html(insertTr);
  	    	}
	  	  }
    	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//참조 메타테이블 컬럼 항목
const dpIngestMetaTblColRefrn = function (table_idntfc_id, refrn_column_idntfc_id) {
	
	const data = {
   		url: '/dp/ingest/meta/tables/column',
   		user_id: 'user00',
   		table_idntfc_id: table_idntfc_id,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestMetaTblColRefrn',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		  
    		  if(errorMsg(data)){
   	          	 return;  
       	  	  }				
	  		
  	    	if(data.contents != ""){
  	    		let insertTr = '';
  	    		$("#refrn_column_idntfc_id option:gt(0)").remove();
  	    		$.each(data.contents, function (idx, el) {
		  	    	
  	    			if(el.column_idntfc_id == refrn_column_idntfc_id){
  	    				insertTr += '<option value="'+el.column_idntfc_id+'" data-engcol="'+el.column_eng_nm+'" selected>'+el.column_korean_nm+'</option>';
  	    				$("#refrn_column_idntfc_id_eng_nm").val(el.column_eng_nm);
  	    			}else{
  	    				insertTr += '<option value="'+el.column_idntfc_id+'" data-engcol="'+el.column_eng_nm+'">'+el.column_korean_nm+'</option>';
  	    			}
		  	    	
  	    		});
  	    		$("#refrn_column_idntfc_id").append(insertTr);
  	    		
  	    	}
	  	  }
    	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//메타테이블 컬럼 항목 상세
const dpIngestMetaTblColDt = function (column_idntfc_id) {
	
	btnDetail();
	let table_idntfc_id = '{{table_idntfc_id}}';
	$("#column_idntfc_id").val(column_idntfc_id);
	
	$("#refrn_column_idntfc_id").find("option:gt(0)").remove();
	$("#refrn_column_idntfc_id_eng_nm").val("");
	
	const data = {
   		url: '/dp/ingest/meta/tables/column/detail',
   		user_id: 'user00',
   		table_idntfc_id: table_idntfc_id,
   		column_idntfc_id: column_idntfc_id,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestMetaTblColDt',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		  
    		  if(errorMsg(data)){
   	          	 return;  
       	  	  }				
	  		
	  		  
  	    	if(data.contents != ""){
  	    		let insertTr = '';
  	    			
    			$("#column_korean_nm").val(data.contents[0].column_korean_nm);
    			$("#refrn_table_idntfc_id").val(data.contents[0].refrn_table_idntfc_id);
    			$("#column_eng_nm").val(data.contents[0].column_eng_nm);
    			$("#refrn_table_idntfc_id_nm").val(data.contents[0].refrn_table_idntfc_id_nm);
    			$("#data_type").val(data.contents[0].data_type).prop("selected", true);
    			if(data.contents[0].data_type == 'VARCHAR' || data.contents[0].data_type == 'NUMERIC'){
    				$('#data_lt').prop('readonly', false);
    			}else{
    				$('#data_lt').prop('readonly', true);
    			}
    			$("#data_lt").val(data.contents[0].data_lt);
//     			$("#refrn_column_idntfc_id").val(data.contents[0].refrn_column_idntfc_id).prop("selected", true);
    			$("#not_null_at").val(data.contents[0].not_null_at).prop("selected", true);
    			$("#dset_knd").val(data.contents[0].dset_knd).prop("selected", true);
//     			$("#refrn_column_idntfc_id_eng_nm").val($("#refrn_column_idntfc_id").data("engcol"));
    			$("#pk_info").val(data.contents[0].pk_info).prop("selected", true);
    			$("#fk_info").val(data.contents[0].fk_info).prop("selected", true);
    			$("#creat_table_at").val(data.contents[0].creat_table_at);
    			$("#use_at").val(data.contents[0].use_at).prop("selected", true);
    			$("#column_stre_type").val(data.contents[0].column_stre_type);
    			$("#column_dc").val(data.contents[0].column_dc);
    			$("#crud_dc").val(data.contents[0].crud_dc);
    			$("#ordr").val(data.contents[0].ordr);
    			$("#indvdl_info_at").val(data.contents[0].indvdl_info_at).prop("selected", true);
    			$("#encpt_at").val(data.contents[0].encpt_at).prop("selected", true);
    			$("#crud_se").val(data.contents[0].crud_se);
  	    		
    			dpIngestMetaTblColRefrn(data.contents[0].refrn_table_idntfc_id, data.contents[0].refrn_column_idntfc_id);
  	    		
  	    	}
	  	  }
    	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//메타테이블 컬럼등록
const dpIngestMetaTblSaveCol = function (){
	let table_idntfc_id = '{{table_idntfc_id}}';
	let column_korean_nm = $("#column_korean_nm").val();
	let refrn_table_idntfc_id = $("#refrn_table_idntfc_id").val();
	let column_eng_nm = $("#column_eng_nm").val();
	let refrn_table_idntfc_id_nm = $("#refrn_table_idntfc_id_nm").val();
	let data_type = $("#data_type").val();
	let data_lt = $("#data_lt").val();
	let refrn_column_idntfc_id = $("#refrn_column_idntfc_id").val();
	let not_null_at = $("#not_null_at").val();
	let dset_knd = $("#dset_knd").val();
	let refrn_column_idntfc_id_eng_nm = $("#refrn_column_idntfc_id_eng_nm").val();
	let pk_info = $("#pk_info").val();
	let fk_info = $("#fk_info").val();
	let creat_table_at = $("#creat_table_at").val();
	let use_at = $("#use_at").val();
	let column_stre_type = $("#column_stre_type").val();
	let column_dc = $("#column_dc").val();
	let crud_dc = $("#crud_dc").val();
	let ordr = $("#ordr").val();
	let indvdl_info_at = $("#indvdl_info_at").val();
	let encpt_at = $("#encpt_at").val();
	let crud_se = $("#crud_se").val();
	let table_eng_nm = $("#table_eng_nm").text();
	
	if(!column_korean_nm){
		alert("한글명을 입력하세요!");
		$('#column_korean_nm').focus();
		return;
	}
	
	if(!column_eng_nm){
		alert("영문명을 입력하세요!");
		$('#column_eng_nm').focus();
		return;
	}
	
// 	if(data_type == 'VARCHAR'){
// 		data_lt = data_lt.replace(/,/gi,'');
// 		if(Number(data_lt) > 99999999){
// 			alert("최대 길이를 초과하였습니다. 99999999 이하의 숫자를 입력해주세요!");
// 			return;
// 		}
// 	}else if(data_type == 'NUMERIC'){
// 		let regex = /^[0-6]{1},[0-3]{1}$/;
// 		if(!regex.test(data_lt)){
// 			alert("최대 길이는 6,3입니다. 형식에 맞게 입력해주세요!");
// 			return;
// 		}
// 	}
	
	const data = {
   		url: '/dp/ingest/meta/tables/save/column',
		user_id: 'user00',
		rl_table_idntfc_id: table_idntfc_id,
		dset_knd: dset_knd,
		ordr: Number(ordr),
		refrn_table_idntfc_id: refrn_table_idntfc_id,
		refrn_column_idntfc_id: refrn_column_idntfc_id,
		table_eng_nm: table_eng_nm,
		column_eng_nm: column_eng_nm,
		column_korean_nm: column_korean_nm,
		column_dc: column_dc,
		data_type: data_type,
		data_lt: data_lt,
		data_frmat: null,
		not_null_at: not_null_at,
		pk_info: pk_info,
		fk_info: fk_info,
		ak_info: null,
		rstrct_cnd: null,
		indvdl_info_at: indvdl_info_at,
		encpt_at: encpt_at,
		othbc_at: null,
		column_stre_type: column_stre_type,
		column_nm: null,
		crud_se: crud_se,
		crud_dc: crud_dc,
		use_at: use_at,
		creat_table_at: creat_table_at,
    };
	
	if(confirm("등록 하시겠습니까?")){
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpIngestMetaTblSaveCol',
	        dataType: 'json',
	        contentType: 'application/json; charset=utf-8',
	        data: JSON.stringify(data),
	    }).done(function (data) {
	  		alert("저장 되었습니다.");
	  		dpIngestMetaTblCol();
	  		$("#tbl_layer").hide();
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });	
	}
	
}

//메타테이블 컬럼 수정
const dpIngestMetaTblUpdateCol = function (){
	let table_idntfc_id = '{{table_idntfc_id}}';
	let column_korean_nm = $("#column_korean_nm").val();
	let refrn_table_idntfc_id = $("#refrn_table_idntfc_id").val();
	let column_eng_nm = $("#column_eng_nm").val();
	let refrn_table_idntfc_id_nm = $("#refrn_table_idntfc_id_nm").val();
	let data_type = $("#data_type").val();
	let data_lt = $("#data_lt").val();
	let refrn_column_idntfc_id = $("#refrn_column_idntfc_id").val();
	let not_null_at = $("#not_null_at").val();
	let dset_knd = $("#dset_knd").val();
	let refrn_column_idntfc_id_eng_nm = $("#refrn_column_idntfc_id_eng_nm").val();
	let pk_info = $("#pk_info").val();
	let fk_info = $("#fk_info").val();
	let creat_table_at = $("#creat_table_at").val();
	let use_at = $("#use_at").val();
	let column_stre_type = $("#column_stre_type").val();
	let column_dc = $("#column_dc").val();
	let crud_dc = $("#crud_dc").val();
	let ordr = $("#ordr").val();
	let indvdl_info_at = $("#indvdl_info_at").val();
	let encpt_at = $("#encpt_at").val();
	let crud_se = $("#crud_se").val();
	let table_eng_nm = $("#table_eng_nm").text();
	let column_idntfc_id = $("#column_idntfc_id").val();
	
	if(!column_korean_nm){
		alert("한글명을 입력하세요!");
		$('#column_korean_nm').focus();
		return;
	}
	
	if(!column_eng_nm){
		alert("영문명을 입력하세요!");
		$('#column_eng_nm').focus();
		return;
	}
	
// 	if(data_type == 'VARCHAR'){
// 		data_lt = data_lt.replace(/,/gi,'');
// 		if(Number(data_lt) > 99999999){
// 			alert("최대 길이를 초과하였습니다. 99999999 이하의 숫자를 입력해주세요!");
// 			return;
// 		}
// 	}else if(data_type == 'NUMERIC'){
// 		let regex = /^[0-6]{1},[0-3]{1}$/;
// 		if(!regex.test(data_lt)){
// 			alert("최대 길이는 6,3입니다. 형식에 맞게 입력해주세요!");
// 			return;
// 		}
// 	}
	
	const data = {
   		url: '/dp/ingest/meta/tables/update/column',
   		column_idntfc_id: column_idntfc_id,
		user_id: 'user00',
		rl_table_idntfc_id: table_idntfc_id,
		dset_knd: dset_knd,
		ordr: Number(ordr),
		refrn_table_idntfc_id: refrn_table_idntfc_id,
		refrn_column_idntfc_id: refrn_column_idntfc_id,
		table_eng_nm: table_eng_nm,
		column_eng_nm: column_eng_nm,
		column_korean_nm: column_korean_nm,
		column_dc: column_dc,
		data_type: data_type,
		data_lt: data_lt,
		data_frmat: null,
		not_null_at: not_null_at,
		pk_info: pk_info,
		fk_info: fk_info,
		ak_info: null,
		rstrct_cnd: null,
		indvdl_info_at: indvdl_info_at,
		encpt_at: encpt_at,
		othbc_at: null,
		column_stre_type: column_stre_type,
		column_nm: null,
		crud_se: crud_se,
		crud_dc: crud_dc,
		use_at: use_at,
		creat_table_at: creat_table_at,
    };
	
	if(confirm("수정 하시겠습니까?")){
	    $.ajax({
	        type: 'POST',
	        url: url+'/dpIngestMetaTblSaveCol',
	        dataType: 'json',
	        contentType: 'application/json; charset=utf-8',
	        data: JSON.stringify(data),
	    }).done(function (data) {
	  		alert("수정 되었습니다.");
	  		dpIngestMetaTblCol();
	  		$("#tbl_layer").hide();
	    }).fail(function (error) {
	        alert(JSON.stringify(error));
	    });	
	}
	
}

//메타 테이블명 검색
const dpIngestPopupMetaTbl = function () {
	
	let table_korean_nm = $("#query").val();
	
	const data = {
   		url: '/dp/ingest/popup/meta_table',
   		user_id: 'user00',	
   		table_korean_nm: table_korean_nm,
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/dpIngestPopupMetaTbl',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
	  	  if (data != null) {
	  		  
    		  if(errorMsg(data)){
   	          	 return;  
       	  	  }				
	  		
  	    	if(data.contents != ""){
  	    		let insertTr = '';
  	    		$.each(data.contents, function (idx, el) {
  	    			insertTr += '<tr>';
  	    			insertTr += '	<td>'+el.dset_korean_nm+'</td>';
  	    			insertTr += '	<td>'+el.table_eng_nm+'</td>';
  	    			insertTr += '	<td><span class="blue bold" style="cursor:pointer" id="dset_nm" data-idntfc_id="'+el.table_idntfc_id+'" data-korean_nm="'+el.table_korean_nm+'" ondblclick="setTableNm(this);">'+el.table_korean_nm+'</span></td>';
  	    			insertTr += '</tr>';
  	    			
  	    		});
  	    		$("#popupMetaTbl").html(insertTr);
  	    	}
	  	  }
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//더블클릭 테이블명 전달
const setTableNm = function(obj){
	let table_idntfc_id = $(obj).data("idntfc_id");
	let table_korean_nm = $(obj).data("korean_nm");
	
	$("#refrn_table_idntfc_id").val(table_idntfc_id);
	$("#refrn_table_idntfc_id_nm").val(table_korean_nm);
	
	$("#refrn_column_idntfc_id").val("").prop("selected", true);
	$("#refrn_column_idntfc_id_eng_nm").val("");
	
	dpIngestMetaTblColRefrn(table_idntfc_id);
	
	closeModal();
}

//메타테이블 컬럼 상세
const dpIngestMetaTblDetail = function (column_idntfc_id) {
	btnDetail();
	dpIngestMetaTblColDt(column_idntfc_id);
}

//메타테이블 컬럼 저장 버튼
const colSaveBtn = function () {
	let type = $("#btn_type").val();
	if(type == 'U'){
		dpIngestMetaTblUpdateCol();
	}else{
		dpIngestMetaTblSaveCol();
	}
	
}

//데이터타입 선택시 데이터길이/컬럼저장타입 변경
const changeDataType = function(obj){
	let val = $(obj).val();
	$('#data_lt').val('');
	if(val == 'VARCHAR'){
		$('#column_stre_type').val('String');
		$('#data_lt').prop('readonly', false);
	}else if(val == 'INTEGER'){
		$('#column_stre_type').val('Integer');
		$('#data_lt').prop('readonly', true);
	}else if(val == 'NUMERIC'){
		$('#column_stre_type').val('Double');
		$('#data_lt').prop('readonly', false);
	}else if(val == 'TIMESTAMPTZ'){
		$('#column_stre_type').val('Date');
		$('#data_lt').prop('readonly', true);
	}else{
		$('#column_stre_type').val('');
		$('#data_lt').prop('readonly', false);
	}
}

//추가 버튼
const btnAdd = function(){
	$("#col_save_btn").text("저장");
	$("#btn_type").val('I');
    $("#tbl_layer").show();
    initDetail();
    let offset = $('#dataset_layer').offset();
    $('html').animate({scrollTop : offset.top}, 300);
}

//상세 버튼
const btnDetail = function(){
	$("#col_save_btn").text("수정");
	$("#btn_type").val('U');
	$("#tbl_layer").show();
    let offset = $('#dataset_layer').offset();
    $('html').animate({scrollTop : offset.top}, 300);
}

//모달 추가
const addModal = function(){
	$('#query').val('');
	$('#popupMetaTbl').empty();
	$('#add_modal').modal('show');
}

//모달 닫기
const closeModal = function(){
	$('#add_modal').modal('hide');
}

//상세 초기화
const initDetail = function(){
	$("#column_korean_nm").val("");
	$("#refrn_table_idntfc_id").val("");
	$("#column_eng_nm").val("");
	$("#refrn_table_idntfc_id_nm").val("");
	$("#data_type").val("").prop("selected", true);
	$("#data_lt").val("");
	$("#data_lt").prop("disabled",false);
	$("#refrn_column_idntfc_id").find("option:gt(0)").remove();
	$("#not_null_at").val("N").prop("selected", true);
	$("#dset_knd").val("D").prop("selected", true);
	$("#refrn_column_idntfc_id_eng_nm").val("");
	$("#pk_info").val("N").prop("selected", true);
	$("#fk_info").val("N").prop("selected", true);
	$("#creat_table_at").val("");
	$("#use_at").val("Y").prop("selected", true);
	$("#column_stre_type").val("");
	$("#column_dc").val("");
	$("#crud_dc").val("");
	$("#ordr").val("");
	$("#indvdl_info_at").val("N").prop("selected", true);
	$("#encpt_at").val("N").prop("selected", true);
	$("#crud_se").val("C").prop("selected", true);
  	
}

//참조컬럼식별자 변경 선택
const changeRefrnColumnNm = function(obj){
	let column_idntfc_id = $(obj).val();
	$("#refrn_column_idntfc_id_eng_nm").val($(obj).find("option:selected").data("engcol"));
}

//목록 페이지
const jsList = function(){
	location.href = url+'/list/';
}

//엔터키가 눌렸을 때
const enterkey = function(e) {
	if (e.keyCode == 13) {
		dpIngestPopupMetaTbl();
    }
}

dpIngestMetaTblTbl();

dpIngestMetaTblCol();

</script>

