{{>layout/header}}

	<div class="right_col" role="main">
	    <div class="row">
	        <div class="col-md-12">
	            <div class="x_panel">
	                <div class="x_title"> 
	                  <h2>HOME > 연계대상 관리 > 데이터분배 설정</h2>
	                  <div class="clearfix"> </div>
	                </div>
	                <div class="x_content">
	                	<div class="form-horizontal form-label-left d-flex align-items-center mb-4 row">
		                    <div class="col-12 col-md-10">
		                      <div class="form-group row">
		                        <label class="control-label">검색</label>
		                        <div class="form-control_box">
		                          <div class="col-md-2 pl-0">
		                            <select class="form-control" name="search_type" id="search_type">
		                                <option value="schemaNm">스키마명</option>
		                                <option value="tbl">테이블명</option>
		                                <option value="srvNm">서비스명</option>
		                            </select>
		                          </div>
		                          <div class="col-md-10 pr-0">
		                            <input class="form-control" type="text" name="query" id="query" onkeypress="enterkey(event);">
		                          </div>
		                        </div>
		                      </div>
		                    </div>
		                    <div class="col-12 col-md-2 btn_search_box">
		                      <button class="btn btn-primary" onclick="btnSearch();"> <i class="glyphicon glyphicon-search"></i></button>
		                    </div>
		                  </div>
		                  <div class="table_btns mt-4">
	                    	<button class="btn btn-primary" type="button" onclick="btnAdd();">등록</button>
                    	</div>
		                <div class="table_responsive">
		                	<div class="talbel_total">총 <span class="red bold" id="total_count"></span>건</div>
		                    <table class="table table-striped" style="text-align: center; word-wrap: break-word;">
		                        <colgroup>
		                        	<col width="15%">
		                        	<col width="25%">
		                        	<col width="10%">
		                        	<col width="10%">
		                        	<col width="10%">
		                        	<col width="10%">
		                        	<col width="10%">
		                        	<col width="10%">
		                        </colgroup>
		                        <thead>
		                            <tr>
		                                <th>서비스명</th>
		                                <th>서비스URL</th>
		                                <th>서비스 여부</th>
		                                <th>삭제 여부</th>
		                                <th>스키마</th>
		                                <th>테이블</th>
		                                <th>테스트</th>
		                                <th>작성자</th>
		                            </tr>
		                        </thead>
		                        <tbody id="d_list">
		                        </tbody>
		                    </table>
		                    <div class="nav justify-content-center"> 
		                      <ul id="pagingul" class="pagination">
							  	</ul> 
		                    </div>
		                </div>
	            	</div>
	        	</div>
	    	</div>
		</div>
	</div>
        
{{>layout/footer}}        

<script>

const commonUrl = '/common/linkTarget';
const url = '/linkTarget';

let init_page = 1;				//초기 페이지
let page = 1;					//페이지
let init_size_per_page = 10;	//초기 개수
let size_per_page = 10;	 		//가져올 개수
let pageCount = 10;		 		//페이징에 나타낼 페이지 수

//데이터분배 설정 리스트
const distributeSetupList = function (page, size_per_page) {
	
	if(!page){
		page = init_page;
	}
	if(!size_per_page){
		size_per_page = init_size_per_page;
	}	
	
	let search_type = $("#search_type").val();
	let query = isEmpty($("#query").data("search"));
	
	$("#query").val(query);	//검색어 갱신(검색버튼 클릭시)
	
	const data = {
   		url: '/services/distribute/setup/list',
   		userId: 'user00',	
   		searchType: search_type,
   		search: query,
   		rowsOfPage: String(size_per_page),
   		nowPageNum: String(page),
    };
	
    $.ajax({
        type: 'POST',
        url: url+'/distributeSetupList',
        dataType: 'json',
        contentType: 'application/json; charset=utf-8',
        data: JSON.stringify(data)
    }).done(function (data) {
    	
	  	  if (data != null) {
	  		$("#d_list").empty();
	  		$("#total_count").text(data.totCnt);
  	    	if(data.contents != ""){
  	    		let insertTr = '';
		  	    $.each(data.contents, function (idx, el) {
		  	    	
		  	    	insertTr += '<tr>';
		  	    	insertTr += '	<td><span class="blue bold" style="cursor:pointer" onclick="btnUpdate(\''+el.dstbId+'\');">'+isEmpty(el.srvNm)+'</span></td>';
		  	    	insertTr += '	<td>'+isEmpty(el.srvUrl)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.srvYn)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.delYn)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.schemaNm)+'</td>';
		  	    	insertTr += '	<td>'+isEmpty(el.tbl)+'</td>';
		  	    	insertTr += '	<td><button class="btn btn-success btn-sm mx-0" type="button">바로가기</button></td>';
		  	    	insertTr += '	<td>'+isEmpty(el.creatorId)+'</td>';
		  	    	insertTr += '</tr>';
		  	    });
		  	  $("#d_list").html(insertTr);
  	    	}
  	    	//페이징 보여줌
  	    	paging(data.totCnt, size_per_page, pageCount, page);
	  	  }
    	  
    }).fail(function (error) {
        alert(JSON.stringify(error));
    });	
}

//검색 버튼
const btnSearch = function(){
	let query = $("#query").val();
	$("#query").data("search", query);
	distributeSetupList();
}

//데이터분배 등록 버튼
const btnAdd = function () {
	location.href = url+'/add/';
}

//데이터분배 상세 조회
const btnUpdate = function (dstbId) {
	location.href = url+'/update/'+dstbId;
}

//페이징 함수 호출
const pagingFun = function(page, size_per_page){
	distributeSetupList(page, size_per_page);
}

//엔터키가 눌렸을 때
const enterkey = function(e) {
	if (e.keyCode == 13) {
		btnSearch();
    }
}

distributeSetupList();

</script>

